<div
  class="relative min-h-screen w-full flex flex-col overflow-hidden 
        bg-gradient-to-tr from-indigo-950 via-purple-950 to-pink-950 
         text-white font-inter rounded-3xl">

  <!-- ✨ Floating Lights -->
  <div class="absolute top-16 left-10 w-[400px] h-[400px] bg-pink-500/15 blur-[180px] rounded-full animate-pulse-slow"></div>
  <div class="absolute bottom-20 right-10 w-[450px] h-[450px] bg-indigo-500/15 blur-[220px] rounded-full animate-pulse-slow"></div>
  <div class="absolute inset-0 bg-gradient-to-b from-white/10 via-transparent to-white/10 opacity-25"></div>
  <!-- <div class="absolute inset-0 bg-black/40"></div>  -->


  <!-- 🌟 HEADER -->
  <header
    class="flex flex-col lg:flex-row items-start lg:items-center justify-between 
           px-10 py-8 z-10 relative bg-gradient-to-tr from-indigo-950 via-purple-950 to-pink-950 backdrop-blur-2xl 
           rounded-3xl mx-6 mt-8 shadow-[0_0_50px_rgba(255,255,255,0.1)] border border-white/10 hover:border-pink-400/30 transition-all duration-500">
    <div>
      <h1 class="text-4xl lg:text-5xl font-extrabold tracking-tight leading-tight drop-shadow-lg">
        👨‍👩‍👧‍👦 Family Connect, 
        <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 via-pink-400 to-violet-400 animate-text">
          {{ user?.username || 'Guest' }}
        </span>
      </h1>
      <p class="text-sm opacity-80 mt-2 italic">Where love, memories, and connection come together 💜</p>
    </div>

    <div class="flex items-center gap-4 mt-5 lg:mt-0">
      <span *ngIf="user?.isAlzheimer"
        class="px-4 py-1.5 bg-gradient-to-r from-pink-600/60 to-purple-600/60 border border-white/20 rounded-full text-sm font-semibold shadow-inner shadow-pink-500/40">
        🧠 Alzheimer Patient
      </span>
      <button
        class="hidden lg:inline-flex px-5 py-2 rounded-xl bg-gradient-to-r from-indigo-500/30 to-purple-500/30 border border-white/10 text-sm hover:scale-105 hover:shadow-lg hover:bg-white/20 transition-all duration-300">
        ⚙️ Settings
      </button>
    </div>
  </header>

  <!-- 🌍 MAIN CONTENT -->
  <main class="grid grid-cols-1 lg:grid-cols-3 gap-8 px-8 py-10 z-10 relative">

    <!-- 💞 LEFT PANEL -->
    <section
      class="p-6 rounded-3xl backdrop-blur-xl bg-gradient-to-tr from-indigo-950 via-purple-950 to-purple-950
             shadow-[0_0_40px_rgba(255,255,255,0.15)] hover:shadow-[0_0_60px_rgba(255,0,255,0.3)] 
             transition-all duration-500 hover:-translate-y-1">
      <h2 class="text-2xl font-bold mb-4 text-pink-300 drop-shadow">👪 Family Connections</h2>

      <!-- Connect form -->
      <div *ngIf="user?.isAlzheimer" class="mb-4">
        <form [formGroup]="form" (ngSubmit)="connectFamilyMember()" class="flex gap-3 items-center">
          <input formControlName="username" placeholder="Enter family member's username"
            class="flex-1 px-4 py-2.5 rounded-xl bg-white/10 border border-white/20 
                   text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-pink-400 transition-all duration-300" />
          <button type="submit"
            class="px-2 py-2 rounded-xl bg-gradient-to-r from-pink-500 to-violet-500 
                   font-semibold shadow-lg hover:scale-105 hover:shadow-pink-400/40 transition-transform duration-300">
            Connect 💌
          </button>
        </form>
      </div>

      <!-- Connected Members -->
      <div *ngIf="familyMembers.length > 0" class="mt-5 space-y-3">
        <h3 class="text-sm font-semibold text-white/80 mb-2 uppercase tracking-wide">Your Connected Family</h3>
        <div *ngFor="let member of familyMembers" 
             (click)="selectMemberAndOpenChat(member)"
             class="flex items-center justify-between bg-gradient-to-r from-indigo-900/40 to-purple-900/30 
                    border border-white/10 rounded-2xl px-5 py-3 hover:from-pink-600/30 hover:to-purple-600/40
                    hover:border-pink-400/40 hover:shadow-[0_0_25px_rgba(255,192,203,0.3)]
                    transition-all duration-300 cursor-pointer">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 
                        flex items-center justify-center font-bold text-white shadow-md">
              {{ member.username.charAt(0) | uppercase }}
            </div>
            <div>
              <div class="font-semibold text-white">{{ member.username }}</div>
              <div class="text-xs text-gray-300/70">Connected 💞</div>
            </div>
          </div>

          <div class="flex items-center gap-2">
            <div *ngIf="member.unread"
              class="bg-pink-500/80 text-xs font-bold px-2 py-0.5 rounded-full shadow-lg animate-bounce">
              {{ member.unread }}
            </div>
            <button *ngIf="user?.isAlzheimer" (click)="startDisconnect(member); $event.stopPropagation()"
              class="p-2 rounded-full hover:bg-red-500/40 transition duration-200">🗑️</button>
          </div>
        </div>
      </div>

      <p *ngIf="familyMembers.length === 0"
         class="text-center text-sm opacity-70 mt-5 italic">
        {{ user?.isAlzheimer ? "You haven’t connected with anyone yet 💫" : "No patients have connected with you yet 💭" }}
      </p>
    </section>

    <!-- 🧠 RIGHT PANEL -->
    <section
      class="lg:col-span-2 p-6 rounded-3xl backdrop-blur-xl bg-gradient-to-tr from-indigo-950 via-purple-950 to-pink-950
             shadow-[0_0_50px_rgba(255,255,255,0.15)] hover:shadow-[0_0_70px_rgba(128,90,213,0.4)] 
             transition-all duration-500 hover:-translate-y-1">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-violet-300 drop-shadow">
          {{ user?.isAlzheimer ? '💭 Your Memories' : '🧾 Memories of ' + memoryOwnerName }}
        </h2>

        <div class="flex items-center gap-3">
          <button (click)="prevPage()" [disabled]="page === 0"
            class="px-3 py-1.5 text-sm bg-white/10 rounded-lg border border-white/10 hover:bg-white/20 transition disabled:opacity-30">◀</button>
          <div class="text-sm opacity-80">Page {{ page + 1 }} / {{ totalPages }}</div>
          <button (click)="nextPage()" [disabled]="page + 1 >= totalPages"
            class="px-3 py-1.5 text-sm bg-white/10 rounded-lg border border-white/10 hover:bg-white/20 transition disabled:opacity-30">▶</button>
          <button (click)="toggleChatPanel()"
            class="ml-3 px-4 py-2 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 font-semibold shadow-md hover:scale-105 transition">
            💬 Chat
          </button>
        </div>
      </div>

      <!-- Memories list -->
      <div class="grid grid-cols-1 gap-5">
        <ng-container *ngIf="memories && memories.length > 0; else noMemories">
          <div *ngFor="let memory of memories"
  class="p-5 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/10
         shadow-lg hover:shadow-[0_0_30px_rgba(255,255,255,0.2)] 
         transition-all duration-400 flex justify-between items-start hover:-translate-y-1">
  <div class="flex-1">
    <h3 class="text-lg font-semibold text-yellow-300">{{ memory.title }}</h3>
    <p class="text-sm text-white/90 mt-1">{{ memory.description }}</p>
    <p class="text-xs text-white/60 mt-2">🏷️ {{ memory.customCategory || memory.category }}</p>

    <div class="mt-3 flex flex-wrap gap-3 items-center">

      <!-- ✅ File condition -->
      <ng-container *ngIf="memory.filePath; else noFile">
        <button (click)="downloadFile(memory.id)"
                class="px-3 py-1 rounded-full text-sm bg-pink-500/40 hover:bg-pink-500/60 transition">
          ⬇️ Download
        </button>
      </ng-container>
      <ng-template #noFile>
        <span class="text-xs text-gray-400 italic">No file uploaded</span>
      </ng-template>

      <!-- ✅ Voice condition -->
      <ng-container *ngIf="memory.voicePath; else noVoice">
        <button (click)="downloadVoice(memory.id)"
                class="px-3 py-1 rounded-full text-sm bg-indigo-500/40 hover:bg-indigo-500/60 transition">
          🔊 Voice
        </button>
      </ng-container>
      <ng-template #noVoice>
        <span class="text-xs text-gray-400 italic">No voice uploaded</span>
      </ng-template>

      <!-- ✅ Delete button only for Alzheimer user -->
      <button *ngIf="user?.isAlzheimer"
              (click)="startDelete(memory.id)"
              class="px-3 py-1 rounded-full text-sm bg-red-500/40 hover:bg-red-500/60 transition">
        🗑️ Delete
      </button>
    </div>
  </div>

  <div class="text-right text-xs opacity-80">
    <p>🕒 {{ memory.createdAt | date:'medium' }}</p>
  </div>
</div>

        </ng-container>

        <ng-template #noMemories>
          <div class="text-center text-gray-400 py-8 italic">No memories found yet 💭</div>
        </ng-template>
      </div>
    </section>
  </main>

  <!-- 💬 CHAT MODAL -->
  <div *ngIf="showChatPanel"
       class="fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50 animate-fade-in">
    <div class="p-6 bg-gradient-to-br from-purple-800/80 to-indigo-900/80 rounded-2xl w-full max-w-3xl border border-white/20 shadow-[0_0_40px_rgba(255,255,255,0.15)] scale-animate">
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-xl font-bold text-yellow-300 drop-shadow">Chat with {{ selectedMember?.username || '—' }}</h3>
        <button (click)="toggleChatPanel()" class="px-3 py-1 bg-white/10 rounded-lg hover:bg-white/20 transition">✖</button>
      </div>

      <div class="max-h-80 overflow-auto mb-3 space-y-3">
        <div *ngIf="selectedMember; else noMember">
          <div *ngFor="let chat of chats[selectedMember.username] || []"
               [ngClass]="{'text-right': isMyMessage(chat)}">
            <div
              class="inline-block px-4 py-2 rounded-xl text-sm shadow-md"
              [ngClass]="isMyMessage(chat) 
                         ? 'bg-gradient-to-r from-pink-500 to-purple-500 ml-auto text-white' 
                         : 'bg-white/10 text-white/90 mr-auto'">
              <div class="opacity-80 text-xs mb-1">
                <strong>{{ chat.fromUser }}</strong> • {{ chat.createdAt | date:'shortTime' }}
              </div>
              <div>{{ chat.message }}</div>
            </div>
          </div>
        </div>
        <ng-template #noMember>
          <div class="text-center text-white/70 italic">Select a family member to start chatting 💬</div>
        </ng-template>
      </div>

      <div class="flex gap-3">
        <input [(ngModel)]="newMessage" (keyup.enter)="sendMessage()"
               placeholder="Type a message..." 
               class="flex-1 px-4 py-2 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:ring-2 focus:ring-pink-400 transition" />
        <button (click)="sendMessage()" 
                class="px-4 py-2 rounded-xl bg-gradient-to-r from-yellow-400 to-pink-400 font-semibold text-indigo-950 hover:scale-105 transition">
          Send 🚀
        </button>
      </div>
    </div>
  </div>
  <div *ngIf="showDisconnectConfirmDialog"
     class="fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50 animate-fade-in">
  <div class="p-8 bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl w-full max-w-md border border-white/20 shadow-lg text-center scale-animate">
    <h3 class="text-xl font-bold text-red-400 mb-2">Confirm Disconnect</h3>
    <p class="text-white/80 mb-6">
      Are you sure you want to disconnect from <strong class="font-semibold text-white">{{ memberToDisconnect?.username }}</strong>?
    </p>
    <div class="flex justify-center gap-4">
      <button (click)="cancelDisconnect()" class="px-6 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition">Cancel</button>
      <button (click)="confirmDisconnect()" class="px-6 py-2 rounded-lg bg-red-600 hover:bg-red-700 transition font-semibold">Yes, Disconnect</button>
    </div>
  </div>
</div>
  <!-- 🩶 FOOTER -->
  <footer class="text-center text-xs opacity-70 py-6">
    © 2025 Memory Care Connect • Made with 💜 and Empathy
  </footer>
</div>


