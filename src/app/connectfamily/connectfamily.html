<div class="min-h-screen w-full flex flex-col bg-gradient-to-tr from-indigo-950 via-purple-950 to-pink-950 text-white relative overflow-hidden p-8 rounded-3xl">

  <!-- Header -->
  <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 z-10">
    <div>
      <h1 class="text-4xl font-extrabold tracking-wide drop-shadow-lg">
        ðŸ‘ª Connect Family, <span class="text-yellow-300">{{ user?.username }}</span>
      </h1>
      <p class="text-sm opacity-70 mt-2">Connect family members, chat & manage memories ðŸ’œ</p>
    </div>
    <span *ngIf="user?.isAlzheimer" class="px-4 py-1 bg-red-500/20 text-red-300 text-sm rounded-full mt-4 md:mt-0 shadow-md">
      ðŸ§  Alzheimer Patient
    </span>
  </header>

  <!-- Connect Family -->
  <section class="bg-white/10 rounded-2xl p-6 shadow-2xl backdrop-blur-md border border-white/10 hover:scale-105 transition-all duration-300 mb-6 z-10">
    <h2 class="text-xl font-bold mb-4 text-yellow-300">Connect a Family Member</h2>
    <form class="flex gap-4 flex-wrap md:flex-nowrap mb-4" [formGroup]="form" (ngSubmit)="addFamilyMember()">
      <input formControlName="username" type="text" placeholder="Enter username"
        class="flex-1 px-4 py-3 rounded-xl bg-white/5 border border-white/10 placeholder:text-slate-300/60 text-white" />
      <button type="submit" class="px-5 py-3 rounded-xl bg-emerald-400 text-slate-900 font-semibold hover:scale-105 transition">Connect</button>
    </form>

    <!-- Chat Open Button -->
    <button (click)="toggleChatPanel()" class="mt-2 px-5 py-3 rounded-xl bg-amber-400 text-slate-900 font-semibold hover:scale-105 transition">
      Open Chat
    </button>
  </section>

  <!-- Chat Panel -->
  <div *ngIf="showChatPanel" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
    <div class="bg-white/10 w-full max-w-3xl rounded-3xl p-6 shadow-2xl backdrop-blur-md border border-white/10 flex flex-col gap-4 relative">
      <!-- Close Button -->
      <button (click)="toggleChatPanel()" class="absolute top-4 right-4 px-3 py-1 bg-red-500 text-white rounded-full hover:scale-105 transition">Close</button>
      
      <!-- Users List -->
      <div class="flex gap-2 overflow-x-auto mb-4">
        <div *ngFor="let member of familyMembers" (click)="openChat(member)"
             [ngClass]="{'bg-amber-400 text-slate-900': selectedMember?.username === member.username, 'bg-white/5 text-white': selectedMember?.username !== member.username}"
             class="px-4 py-2 rounded-xl cursor-pointer flex items-center gap-2">
          {{ member.username }}
          <span *ngIf="member.unread && member.unread > 0" class="bg-red-500 px-2 py-0.5 rounded-full text-xs font-bold text-white">{{ member.unread }}</span>
        </div>
      </div>

      <!-- Chat Messages -->
      <div class="flex flex-col gap-2 max-h-64 overflow-y-auto mb-4">
        <div *ngFor="let chat of chats[selectedMember?.username || '']" class="p-3 rounded-xl"
             [ngClass]="{'bg-emerald-400/20 self-end': chat.sender === user?.username, 'bg-white/10 self-start': chat.sender !== user?.username}">
          <p class="text-sm"><span class="font-semibold">{{ chat.sender }}:</span> {{ chat.message }}</p>
          <p class="text-[10px] text-slate-300 mt-1">{{ chat.createdAt | date:'shortTime' }}</p>
        </div>
      </div>

      <!-- Input -->
      <div class="flex gap-3">
        <input [(ngModel)]="newMessage" type="text" placeholder="Type a message..."
               class="flex-1 px-4 py-3 rounded-xl bg-white/5 border border-white/10 placeholder:text-slate-300/60 text-white"/>
        <button (click)="sendMessage()" class="px-5 py-3 rounded-xl bg-amber-400 text-slate-900 font-semibold hover:scale-105 transition">Send</button>
      </div>
    </div>
  </div>

  <!-- Search Memories -->
  <!-- Search Memories -->
<section class="bg-white/10 rounded-2xl p-6 shadow-2xl backdrop-blur-md border border-white/10 hover:scale-105 transition-all duration-300 mb-8 z-10">
  <h2 class="text-xl font-bold mb-4 text-yellow-300">Memories</h2>
  <input type="text" placeholder="Search memories..." [(ngModel)]="searchTerm"
         class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 placeholder:text-slate-300/60 text-white mb-4"/>

  <div class="flex flex-col gap-4 max-h-96 overflow-y-auto">
    <div *ngFor="let memory of filteredMemories()"
         class="bg-white/5 border border-white/10 rounded-2xl p-4 hover:bg-white/10 transition">
      <h3 class="text-lg font-semibold text-yellow-300">{{ memory.title }}</h3>
      <p class="text-sm text-slate-200 mb-1">{{ memory.description }}</p>
      <p class="text-xs text-slate-400 mb-2">Category: {{ memory.customCategory || memory.category }}</p>
      <div class="flex gap-3 flex-wrap">
        <a *ngIf="memory.fileUrl" [href]="memory.fileUrl" target="_blank"
           class="px-3 py-1 bg-emerald-400 text-slate-900 rounded-lg text-sm hover:scale-105 transition">View File</a>
        <audio *ngIf="memory.voiceNoteUrl" controls class="h-10">
          <source [src]="memory.voiceNoteUrl" type="audio/mpeg">
          Your browser does not support the audio element.
        </audio>
      </div>
      <p class="text-[10px] text-slate-400 mt-2">Created At: {{ memory.createdAt | date:'short' }}</p>
    </div>
  </div>
</section>


</div>
