<!-- ADD MEMORY PAGE -->
<div class="min-h-screen w-full flex items-center justify-center px-6 py-16 
            bg-gradient-to-tr from-indigo-950 via-purple-900 to-pink-800 
            text-white relative overflow-hidden">

  <!-- Floating Glows -->
  <div class="absolute top-20 left-10 w-[400px] h-[400px] bg-pink-500 opacity-30 blur-[160px] animate-pulse-slow"></div>
  <div class="absolute bottom-20 right-10 w-[400px] h-[400px] bg-indigo-500 opacity-25 blur-[160px] animate-pulse-slow"></div>
  <div class="absolute top-1/2 left-1/3 w-[300px] h-[300px] bg-purple-700 opacity-25 blur-[180px] rounded-full animate-pulse"></div>
  
  <!-- Form Wrapper -->
  <div class="relative z-10 w-full max-w-5xl">

    <!-- STEP 1: Quick Question -->
    <div *ngIf="askingPatient"
         class="bg-gradient-to-br from-black/50 via-black/50 to-black/50
                backdrop-blur-2xl p-12 rounded-3xl border border-pink-500/20 
                shadow-[0_0_60px_rgba(0,0,0,0.6),0_0_30px_rgba(255,0,150,0.2)] 
                hover:shadow-[0_0_90px_rgba(255,0,150,0.3),0_0_50px_rgba(0,0,0,0.8)] 
                transform transition duration-500 hover:scale-[1.02] animate-fadeIn text-center">

      <h2 class="text-4xl font-extrabold mb-6 bg-clip-text text-transparent 
                 bg-gradient-to-r from-pink-400 via-purple-400 to-indigo-400 drop-shadow-[0_0_25px_rgba(255,0,200,0.5)]">
        Quick Question
      </h2>

      <p class="text-white/80 mb-8 text-lg tracking-wide">
        Are you an Alzheimer‚Äôs patient? This helps us personalize reminders and allow family to assist with your daily activities.
      </p>

      <div class="flex justify-center gap-6">
        <button (click)="answerPatient(true)"
                class="px-8 py-4 rounded-2xl bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 
                       text-white font-bold shadow-lg hover:scale-110 transition-all">
          Yes, I am
        </button>
        <button (click)="answerPatient(false)"
                class="px-8 py-4 rounded-2xl border border-white/30 bg-white/5 
                       text-white font-bold hover:bg-white/10 transition">
          No, I'm not
        </button>
      </div>
    </div>

    <!-- STEP 2: Form -->
    <div *ngIf="!askingPatient && showForm"
         class="bg-gradient-to-br from-black/40 via-black/40 to-black/40 
                backdrop-blur-2xl p-12 rounded-3xl border border-pink-500/20 
                shadow-[0_0_60px_rgba(0,0,0,0.6),0_0_30px_rgba(255,0,150,0.2)] 
                hover:shadow-[0_0_90px_rgba(255,0,150,0.3),0_0_50px_rgba(0,0,0,0.8)] 
                transform transition duration-500 hover:scale-[1.02] animate-fadeIn">

      <!-- Title -->
      <h1 class="text-5xl font-extrabold mb-4 text-center bg-clip-text text-transparent 
                 bg-gradient-to-r from-pink-400 via-purple-400 to-indigo-400 
                 drop-shadow-[0_0_30px_rgba(255,0,200,0.5)]">
        Add a New Memory
      </h1>
      <p class="text-center text-white/80 mb-10 text-lg tracking-wide">
        Capture moments, notes, and reminders ‚Äî beautifully & securely ‚ú®
      </p>

      <!-- FORM -->
      <form (ngSubmit)="submit()" [formGroup]="form" class="grid grid-cols-1 md:grid-cols-2 gap-8">

        <!-- Title -->
        <input formControlName="title" placeholder="Memory Title (e.g., Family Picnic, Doctor Visit)" required
               class="col-span-2 px-6 py-4 rounded-2xl bg-black/40 border border-white/10 text-white 
                      placeholder-white/60 focus:ring-2 focus:ring-pink-400 focus:border-pink-400 
                      transition duration-300 outline-none text-lg shadow-inner"/>

        <!-- Category -->
        <div class="relative col-span-2 md:col-span-1">
          <label class="text-white/80 mb-2 block">Category</label>
          <div (click)="dropdownOpen = !dropdownOpen"
               class="px-6 py-4 bg-black/40 border border-pink-500/20 
                      rounded-2xl cursor-pointer flex justify-between items-center 
                      hover:shadow-[0_0_25px_rgba(255,0,200,0.2)] transition duration-300">
            <span>{{ selectedCategory || 'Select Category' }}</span>
            <svg class="w-5 h-5 text-pink-300 transform transition-transform duration-300" 
                 [class.rotate-180]="dropdownOpen"
                 fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>

          <!-- Dropdown -->
          <div *ngIf="dropdownOpen"
               class="absolute mt-2 w-full bg-gradient-to-br from-[#0f0f1a] via-[#151521] to-[#1a0f1a] 
                      backdrop-blur-xl border border-pink-500/30 
                      rounded-2xl z-20 overflow-hidden animate-fadeIn shadow-xl">
            <div *ngFor="let option of categories"
                 (click)="selectCategory(option)"
                 class="px-6 py-3 hover:bg-pink-600/30 transition cursor-pointer">
              {{ option.label }}
            </div>
          </div>
        </div>

        <!-- Conditional Medication Fields -->
        <div *ngIf="form.value.category === 'medication'" class="col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4">
          <input formControlName="medicationName" placeholder="Medicine Name"
                 class="h-14.5 px-4 py-3 rounded-2xl bg-black/40 border border-white/10 text-white placeholder-white/60 focus:ring-2 focus:ring-pink-400 transition duration-300 outline-none"/>
          <input formControlName="dosage" placeholder="Dosage"
                 class="h-14.5 px-4 py-3 rounded-2xl bg-black/40 border border-white/10 text-white placeholder-white/60 focus:ring-2 focus:ring-pink-400 transition duration-300 outline-none"/>
          <input formControlName="storageLocation" placeholder="Storage Location"
                 class="h-14.5 px-4 py-3 rounded-2xl bg-black/40 border border-white/10 text-white placeholder-white/60 focus:ring-2 focus:ring-pink-400 transition duration-300 outline-none"/>
        </div>
        <div *ngIf="form.value.category === 'other'" class="col-span-2 grid grid-cols-1 md:grid-cols-2 gap-3 ">
          <input formControlName="customCategory" placeholder="Enter your CustomCategory"
                 class="h-14.5 px-4 py-3 rounded-2xl bg-black/40 border border-white/10 text-white placeholder-white/60 focus:ring-2 focus:ring-pink-400 transition duration-300 outline-none"/>
        </div>

  <!-- File Upload -->
<div class="col-span-2 md:col-span-1">
  <label class="text-white/80 mb-2 block">Attach Document / Image</label>

  <!-- File input wrapper -->
  <div class="flex items-center bg-black/40 border border-white/10 rounded-2xl px-4 py-3">
    <input type="file" (change)="onFileSelected($event)"
           class="hidden" #fileInput />

    <!-- Choose File button -->
    <button type="button" (click)="fileInput.click()"
            class="px-4 py-2 rounded-xl bg-gradient-to-r from-pink-400 to-purple-500 
                   text-white font-semibold hover:scale-105 transition duration-300">
      Choose File
    </button>

    <!-- Show chosen file name + remove -->
    <div class="flex items-center ml-3 flex-1 overflow-hidden" *ngIf="chosenFile">
      <span class="truncate text-sm text-white/80">{{ chosenFile.name }}</span>
      <button type="button" (click)="removeFile()" 
              class="ml-3 text-white/60 hover:text-white transition">
        ‚ùå
      </button>
    </div>

    <!-- Show ‚ÄúNo file chosen‚Äù if nothing -->
    <span *ngIf="!chosenFile" class="ml-3 text-sm text-white/50">No file chosen</span>
  </div>
</div>



        <!-- Description -->
        <textarea formControlName="description" placeholder="Write your memory details..." rows="5"
                  class="col-span-2 px-6 py-4 rounded-2xl bg-black/40 border border-white/10 text-white 
                         placeholder-white/60 focus:ring-2 focus:ring-pink-400 focus:border-pink-400 
                         transition duration-300 outline-none resize-none text-lg shadow-inner"></textarea>

        <!-- üéôÔ∏è Voice Note Upload -->
        <div class="col-span-2">
          <label class="text-white/80 mb-2 block">Voice Note</label>

          <!-- Upload voice note -->
          <input type="file" accept="audio/*" (change)="onVoiceNoteSelected($event)"
                 class="w-full text-sm text-white bg-black/40 border border-white/10 rounded-2xl px-5 py-3 
                        file:mr-3 file:px-4 file:py-2 file:rounded-xl file:border-none 
                        file:bg-gradient-to-r file:from-indigo-400 file:to-pink-500 
                        file:text-white file:font-semibold hover:file:scale-105 transition duration-300 mb-4"/>

          <!-- Record voice note -->
          <div class="flex items-center gap-4">
            <button type="button" (click)="startRecording()" [disabled]="recording"
                    class="px-5 py-3 rounded-xl bg-pink-500 hover:bg-pink-600 transition text-white font-semibold">
              üéôÔ∏è Start Recording
            </button>
            <button type="button" (click)="stopRecording()" [disabled]="!recording"
                    class="px-5 py-3 rounded-xl bg-indigo-500 hover:bg-indigo-600 transition text-white font-semibold">
              ‚èπ Stop Recording
            </button>
          </div>

          <!-- Status message -->
          <p *ngIf="successMessage && recording" class="text-green-400 font-medium mt-2">
            {{ successMessage }}
          </p>
          
          <!-- Preview recorded/uploaded audio -->
          <div *ngIf="voiceBlob" class="mt-4 space-y-3">
            <p class="text-green-400 font-medium">{{ successMessage }}</p>
            <audio *ngIf="audioURL" [src]="audioURL" controls class="w-full rounded-xl"></audio>
            <button type="button" (click)="deleteVoiceNote()" 
                    class="px-4 py-2 rounded-xl bg-red-500 hover:bg-red-600 text-white font-semibold transition">
              üóë Delete Recording
            </button>
          </div>
        </div>

        <!-- Reminder -->
        <div class="relative col-span-2">
          <label class="text-white/80 mb-2 block">Set Reminder</label>
          <div (click)="calendarOpen = !calendarOpen"
               class="px-6 py-4 bg-black/40 
                      border border-pink-500/20 rounded-2xl cursor-pointer flex justify-between items-center 
                      hover:shadow-[0_0_25px_rgba(255,0,200,0.2)] transition duration-300">
            <span>{{ selectedDate ? (selectedDate | date:'medium') : 'Pick a date & time' }}</span>
            <svg class="w-6 h-6 text-pink-300" fill="none" stroke="currentColor" stroke-width="2"
                 viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
                 d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 0 00-2 2z"/></svg>
          </div>

          <!-- Calendar Popup -->
          <div *ngIf="calendarOpen" 
               class="absolute mt-3 w-80 bg-gradient-to-br from-[#0f0f1a] via-[#151521] to-[#1a0f1a] 
                      border border-pink-500/30 rounded-2xl p-6 shadow-[0_0_30px_rgba(255,0,200,0.25)] animate-slideUp z-30">
            
            <input type="date" (change)="onDateChange($event)" 
                   class="w-full mb-3 px-4 py-3 rounded-xl bg-black/60 text-white border border-white/10 [color-scheme:dark]"/>
            
            <input type="time" (change)="onTimeChange($event)" 
                   class="w-full px-4 py-3 rounded-xl bg-black/60 text-white border border-white/10 [color-scheme:dark]"/>
            
            <button type="button" (click)="applyDate()" 
                    class="mt-4 w-full py-3 rounded-xl bg-gradient-to-r from-pink-400 via-purple-400 to-indigo-500 
                           text-white font-bold hover:scale-105 transition-all">Set Reminder</button>
          </div>
        </div>

        <!-- üîÅ Repeat Mode -->
        <div class="col-span-2">
          <label class="text-white/80 mb-2 block">Repeat Reminder</label>
          <div class="flex items-center gap-4 bg-black/40 border border-pink-500/20 rounded-2xl px-6 py-4">
            <input type="checkbox" formControlName="reminderDaily" id="reminderDaily"
                   class="w-5 h-5 accent-pink-500 cursor-pointer"/>
            <label for="reminderDaily" class="cursor-pointer">Repeat Daily</label>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="col-span-2 mt-6">
          <button type="submit" [disabled]="loading"
                  class="relative overflow-hidden group w-full py-5 rounded-2xl bg-gradient-to-r 
                         from-pink-400 via-purple-500 to-indigo-600 text-lg font-bold text-white 
                         shadow-[0_0_25px_rgba(255,0,255,0.3)] hover:shadow-[0_0_45px_rgba(255,0,255,0.5)] 
                         hover:scale-105 transition-all duration-300">
            <span class="relative z-10">{{ loading ? 'Uploading...' : 'üíæ Save Memory' }}</span>
            <div class="absolute inset-0 bg-white/20 opacity-0 group-hover:opacity-100 transition duration-300"></div>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
